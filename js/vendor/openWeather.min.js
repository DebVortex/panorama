/*!

Name: Open Weather
Dependencies: jQuery, OpenWeatherMap API
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: August 28, 2013
Licensed under the MIT license

*/
;(function(a){a.fn.openWeather=function(b){if(!this.length){return this}var e={descriptionTarget:null,maxTemperatureTarget:null,minTemperatureTarget:null,windSpeedTarget:null,humidityTarget:null,sunriseTarget:null,sunsetTarget:null,placeTarget:null,iconTarget:null,customIcons:null,units:"c",city:null,lat:null,lng:null,key:null,success:function(){},error:function(h){}};var d=this;var c=a(this);var f;d.settings={};d.settings=a.extend({},e,b);if(d.settings.city!=null){f="http://api.openweathermap.org/data/2.5/weather?q="+d.settings.city.replace(" ","")}else{if(d.settings.lat!=null&&d.settings.lng!=null){f="http://api.openweathermap.org/data/2.5/weather?lat="+d.settings.lat+"&lon="+d.settings.lng}}if(d.settings.key!=null){f+="&APPID="+d.settings.key}var g=function(m){var j=m*1000;var i=new Date(j);var h=i.getHours();if(h>12){hoursRemaining=24-h;h=12-hoursRemaining}var k=i.getMinutes();k=k.toString();if(k.length<2){k=0+k}var l=h+":"+k;return l};a.ajax({type:"GET",url:f,dataType:"jsonp",success:function(i){if(d.settings.units=="f"){var n=Math.round(((i.main.temp-273.15)*1.8)+32)+"°F";var j=Math.round(((i.main.temp_min-273.15)*1.8)+32)+"°F";var o=Math.round(((i.main.temp_max-273.15)*1.8)+32)+"°F"}else{var n=Math.round(i.main.temp-273.15)+"°C";var j=Math.round(i.main.temp_min-273.15)+"°C";var o=Math.round(i.main.temp_max-273.15)+"°C"}c.html(n);if(d.settings.minTemperatureTarget!=null){a(d.settings.minTemperatureTarget).text(j)}if(d.settings.maxTemperatureTarget!=null){a(d.settings.maxTemperatureTarget).text(o)}a(d.settings.descriptionTarget).text(i.weather[0].description);if(d.settings.iconTarget!=null&&i.weather[0].icon!=null){if(d.settings.customIcons!=null){var p=i.weather[0].icon;var m;var q;if(p.indexOf("d")!=-1){q="day"}else{q="night"}if(p=="01d"||p=="01n"){m="clear"}if(p=="02d"||p=="02n"||p=="03d"||p=="03n"||p=="04d"||p=="04n"){m="clouds"}if(p=="09d"||p=="09n"||p=="10d"||p=="10n"){m="rain"}if(p=="11d"||p=="11n"){m="storm"}if(p=="13d"||p=="13n"){m="snow"}if(p=="50d"||p=="50n"){m="mist"}var l=d.settings.customIcons+q+"/"+m+".png"}else{var l="http://openweathermap.org/img/w/"+i.weather[0].icon+".png"}a(d.settings.iconTarget).attr("src",l)}if(d.settings.placeTarget!=null){a(d.settings.placeTarget).text(i.name+", "+i.sys.country)}if(d.settings.windSpeedTarget!=null){a(d.settings.windSpeedTarget).text(Math.round(i.wind.speed)+" Mph")}if(d.settings.humidityTarget!=null){a(d.settings.humidityTarget).text(i.main.humidity+"%")}if(d.settings.sunriseTarget!=null){var k=g(i.sys.sunrise);a(d.settings.sunriseTarget).text(k+" AM")}if(d.settings.sunsetTarget!=null){var h=g(i.sys.sunset);a(d.settings.sunsetTarget).text(h+" PM")}d.settings.success.call(this)},error:function(h,j,i){d.settings.error.call(this,j)}})}})(jQuery);